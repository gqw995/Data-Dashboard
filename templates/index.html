<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿å‘Šæ•°æ®åˆ†æç³»ç»Ÿ - æ–‡ä»¶ä¸Šä¼ </title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š å¹¿å‘Šæ•°æ®åˆ†æå’Œçœ‹æ¿ç³»ç»Ÿ</h1>
            <p class="subtitle">ä¸Šä¼ æ•°æ®æ–‡ä»¶ï¼Œç”Ÿæˆå¯è§†åŒ–åˆ†ææŠ¥å‘Š</p>
        </header>

        <main>
            <form id="uploadForm" class="upload-form">
                <div class="upload-section">
                    <h2>1. ä¸Šä¼ ä»£ç†å•†å‰ç«¯æ•°æ®</h2>
                    
                    <div class="file-upload-group">
                        <label for="kiwi_file" class="file-label">
                            <span class="file-icon">ğŸ“</span>
                            <span class="file-text">å¥‡å¼‚æœä»£ç†å•†æ•°æ®</span>
                            <span class="file-hint">ï¼ˆExcelæ–‡ä»¶ï¼‰</span>
                        </label>
                        <input type="file" id="kiwi_file" name="kiwi_file" accept=".xlsx,.xls" class="file-input">
                        <div class="file-name" id="kiwi_file_name">æœªé€‰æ‹©æ–‡ä»¶</div>
                    </div>

                    <div class="file-upload-group">
                        <label for="wabang_file" class="file-label">
                            <span class="file-icon">ğŸ“</span>
                            <span class="file-text">å“‡æ£’ä»£ç†å•†æ•°æ®</span>
                            <span class="file-hint">ï¼ˆExcelæ–‡ä»¶ï¼‰</span>
                        </label>
                        <input type="file" id="wabang_file" name="wabang_file" accept=".xlsx,.xls" class="file-input">
                        <div class="file-name" id="wabang_file_name">æœªé€‰æ‹©æ–‡ä»¶</div>
                    </div>
                </div>

                <div class="upload-section">
                    <h2>2. ä¸Šä¼ åç«¯æ•°æ®</h2>
                    
                    <div class="file-upload-group">
                        <label for="backend_file" class="file-label required">
                            <span class="file-icon">ğŸ“</span>
                            <span class="file-text">åä¸ºå¹¿å‘Šæ•°æ®</span>
                            <span class="file-hint">ï¼ˆExcelæ–‡ä»¶ï¼‰*å¿…å¡«</span>
                        </label>
                        <input type="file" id="backend_file" name="backend_file" accept=".xlsx,.xls" class="file-input" required>
                        <div class="file-name" id="backend_file_name">æœªé€‰æ‹©æ–‡ä»¶</div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <span class="btn-icon">ğŸš€</span>
                        <span>ä¸Šä¼ å¹¶å¤„ç†æ•°æ®</span>
                    </button>
                    <button type="reset" class="btn btn-secondary" id="resetBtn">
                        <span class="btn-icon">ğŸ”„</span>
                        <span>é‡ç½®</span>
                    </button>
                </div>
            </form>

            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <p>æ­£åœ¨å¤„ç†æ•°æ®ï¼Œè¯·ç¨å€™...</p>
            </div>

            <div id="message" class="message hidden"></div>
        </main>

        <footer>
            <p>æç¤ºï¼šè¯·ç¡®ä¿ä¸Šä¼ çš„Excelæ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡50MB</p>
        </footer>
    </div>

    <script>
        // æ–‡ä»¶é€‰æ‹©æ˜¾ç¤º
        document.getElementById('kiwi_file').addEventListener('change', function(e) {
            const fileName = e.target.files[0] ? e.target.files[0].name : 'æœªé€‰æ‹©æ–‡ä»¶';
            document.getElementById('kiwi_file_name').textContent = fileName;
        });

        document.getElementById('wabang_file').addEventListener('change', function(e) {
            const fileName = e.target.files[0] ? e.target.files[0].name : 'æœªé€‰æ‹©æ–‡ä»¶';
            document.getElementById('wabang_file_name').textContent = fileName;
        });

        document.getElementById('backend_file').addEventListener('change', function(e) {
            const fileName = e.target.files[0] ? e.target.files[0].name : 'æœªé€‰æ‹©æ–‡ä»¶';
            document.getElementById('backend_file_name').textContent = fileName;
        });

        // è¡¨å•æäº¤
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            const kiwiFile = document.getElementById('kiwi_file').files[0];
            const wabangFile = document.getElementById('wabang_file').files[0];
            const backendFile = document.getElementById('backend_file').files[0];
            
            // æ£€æŸ¥è‡³å°‘æœ‰ä¸€ä¸ªä»£ç†å•†æ–‡ä»¶
            if (!kiwiFile && !wabangFile) {
                showMessage('è¯·è‡³å°‘ä¸Šä¼ ä¸€ä¸ªä»£ç†å•†æ•°æ®æ–‡ä»¶ï¼ˆå¥‡å¼‚æœæˆ–å“‡æ£’ï¼‰', 'error');
                return;
            }
            
            if (!backendFile) {
                showMessage('è¯·ä¸Šä¼ åç«¯æ•°æ®æ–‡ä»¶', 'error');
                return;
            }
            
            if (kiwiFile) formData.append('kiwi_file', kiwiFile);
            if (wabangFile) formData.append('wabang_file', wabangFile);
            formData.append('backend_file', backendFile);
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('submitBtn').disabled = true;
            hideMessage();
            
            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(result.message, 'success');
                    // å»¶è¿Ÿè·³è½¬ï¼Œè®©ç”¨æˆ·çœ‹åˆ°æˆåŠŸæ¶ˆæ¯
                    setTimeout(() => {
                        window.location.href = '/dashboard';
                    }, 1500);
                } else {
                    showMessage(result.message || 'å¤„ç†å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', 'error');
            } finally {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('submitBtn').disabled = false;
            }
        });
        
        // é‡ç½®æŒ‰é’®
        document.getElementById('resetBtn').addEventListener('click', function() {
            document.getElementById('kiwi_file_name').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
            document.getElementById('wabang_file_name').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
            document.getElementById('backend_file_name').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
            hideMessage();
        });
        
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.classList.remove('hidden');
        }
        
        function hideMessage() {
            document.getElementById('message').classList.add('hidden');
        }
    </script>
</body>
</html>




