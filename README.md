# 广告数据分析和看板系统

## 项目简介

这是一个专为广告投放管理人员设计的网页工具，用于处理和分析广告投放数据。系统支持上传多个代理商的前端数据和后端转化数据，自动进行数据匹配和清洗，并生成可视化的数据看板。

## 功能特性

### 1. 数据上传
- 支持上传2个代理商的前端数据Excel文件：
  - 奇异果代理商数据
  - 哇棒代理商数据
- 支持上传1个后端数据Excel文件：
  - 华为广告数据

### 2. 数据处理
- 自动识别和读取Excel文件中的指定工作表
- 数据字段标准化和映射
- 计划名称自动拆分（提取代理、资源位、出价方式、年龄、定向、素材样式、利益点等信息）
- 前后端数据匹配（基于计划ID和日期）
- 数据清洗（ID清洗、日期标准化、百分比处理、数值转换）

### 3. 数据看板
- **多维度分析**：
  - 按日期分析
  - 按投放方式分析
  - 按代理商分析
  - 按客群（定向多选弹窗）分析
  - 按资源位分析
  - 按素材样式 / 利益点分析

- **核心指标展示**：
  - 花费、曝光量、点击量、下载量、安装量
  - 点击率、点击下载率
  - 注册人数、进件人数、授信人数（成功）、支用人数（成功）
  - 支用笔数、支用金额、授信金额
  - 人均授信额度、笔均支用金额、总结算花费、平均执行利率
  - 注册成本、进件成本、下载成本、授信成本、支用成本
  - 平均执行利率、平均对客利率

- **交互与可视化**：
  - 日期、代理商、投放方式、资源位、素材样式、利益点等筛选
  - 定向通过弹窗多选，支持一键清空与确认
  - 图表覆盖每日花费/结算花费趋势、代理商出价结构、出价方式/定向/资源位分布、准入/授信/支用通过率趋势
  - 实时数据更新与导出

## 安装和使用

### 方式一：使用 GitHub Actions 自动打包（最推荐）⭐

**无需本地环境，自动打包 Windows 和 Mac 版本！**

1. 将代码推送到 GitHub 仓库
2. 创建版本标签：`git tag v1.0.0 && git push origin v1.0.0`
3. 在 GitHub Actions 页面下载打包好的应用

**详细说明请查看：[GitHub Actions使用指南.md](GitHub Actions使用指南.md)**

### 方式二：本地打包成独立应用程序

系统已支持打包成可在Windows和Mac上独立运行的应用程序，无需安装Python环境。

**详细打包说明请查看：[打包说明.md](打包说明.md)**

**快速打包：**
- **Windows**: 运行 `build_windows.bat`
- **Mac**: 运行 `./build_mac.sh`

打包完成后，将 `dist` 目录下的可执行文件复制到任何电脑即可运行。

**注意**：在 Mac 上无法直接打包 Windows 版本，建议使用 GitHub Actions。

### 方式二：直接运行Python代码

### 环境要求
- Python 3.7+
- 现代浏览器（Chrome、Firefox、Safari、Edge）

### 安装步骤

**方法一：使用启动脚本（推荐）**
```bash
./start.sh
```

**方法二：手动启动**
1. **安装Python依赖**
```bash
pip3 install -r requirements.txt
# 或者
pip install -r requirements.txt
```

2. **启动服务**
```bash
python3 app.py
# 或者
python app.py
```

3. **访问系统**
打开浏览器，访问：`http://localhost:5000`

### 使用流程

1. **上传数据文件**
   - 点击"选择文件"按钮，分别上传对应的Excel文件（文件名无限制）：
     - 奇异果代理商数据Excel（工作表需为"计划数据"）
     - 哇棒代理商数据Excel（工作表需为"总数据源"）
     - 华为广告数据Excel（工作表需为"分计划明细表"）
   - 点击"上传并处理"按钮

2. **查看数据看板**
   - 上传成功后，系统自动跳转到数据看板页面
   - 使用页面顶部的筛选器进行数据筛选
   - 查看各类图表和指标

3. **导出数据**
   - 在数据看板页面，点击"导出数据"按钮
   - 下载处理后的完整数据表

## 文件结构

```
项目根目录/
├── README.md                 # 项目说明文档
├── requirements.txt          # Python依赖包列表
├── app.py                    # Flask主程序
├── data_processor.py         # 数据处理模块
├── templates/                # HTML模板目录
│   ├── index.html           # 文件上传页面
│   └── dashboard.html       # 数据看板页面
├── static/                   # 静态资源目录
│   ├── css/
│   │   └── style.css        # 样式文件
│   └── js/
│       └── dashboard.js     # 看板交互逻辑
└── uploads/                  # 上传文件临时目录（自动创建）
```

## 数据格式要求

### 奇异果代理商数据
- 工作表名称：`计划数据`
- 必需字段：计划名称、计划ID、日期/时间、花费、曝光量、点击量等

### 哇棒代理商数据
- 工作表名称：`总数据源`
- 必需字段：计划名称、计划ID、时间、花费、曝光量、点击量等

### 华为广告数据
- 工作表名称：`分计划明细表`
- 必需字段：event_chnl_dtl（计划ID）、event_dt（日期）、以及各类转化数据

## 技术架构

- **后端**：Flask（Python Web框架）
- **数据处理**：Pandas（数据处理和分析）
- **前端**：HTML5 + CSS3 + JavaScript
- **可视化**：Chart.js（图表库）
- **文件处理**：openpyxl（Excel文件读写）

## 注意事项

1. 上传的Excel文件需要符合指定的格式要求
2. 文件大小建议不超过50MB
3. 数据处理可能需要几秒钟时间，请耐心等待
4. 建议使用Chrome浏览器以获得最佳体验

## 常见问题

### Q: 上传文件后提示"未找到文件"？
A: 请确保文件格式为.xlsx或.xls，并且工作表名称正确（奇异果：计划数据，哇棒：总数据源，华为：分计划明细表）

### Q: 数据看板显示为空？
A: 请检查上传的数据文件是否包含有效数据，以及筛选条件是否过于严格

### Q: 如何处理数据匹配失败的情况？
A: 系统使用左连接匹配数据，即使后端数据缺失，前端数据仍会显示。请检查计划ID和日期格式是否正确

### Q: 访问时出现 HTTP ERROR 403 错误？
A: 这通常是因为端口被占用或服务未正确启动。解决方法：
1. 运行诊断脚本检查：`python3 check_server.py`
2. 运行端口修复脚本：`./fix_port.sh`
3. 或者直接启动应用，系统会自动选择可用端口（5000-5099）
4. 启动后注意查看终端输出的实际访问地址

### Q: 如何查看服务是否正常启动？
A: 启动后，终端会显示类似以下信息：
```
==================================================
广告数据分析和看板系统
==================================================
服务启动中...
访问地址: http://localhost:5000
==================================================
 * Running on http://127.0.0.1:5000
```
如果端口被占用，会自动使用其他端口，请查看终端输出的实际地址

## 更新日志

### v1.0.0 (2025-01-XX)
- 初始版本发布
- 支持多文件上传和数据合并
- 实现基础数据看板功能
- 支持多维度数据筛选和分析

## 项目反思与改进

### 已完成功能
✅ 完整的文件上传功能，支持3个Excel文件同时上传  
✅ 基于merge_ads_data_v4逻辑的数据处理模块  
✅ 前后端数据自动匹配和清洗  
✅ 多维度数据筛选（日期、代理商、出价方式、年龄、定向、资源位）  
✅ 丰富的可视化图表（趋势图、对比图、分布图）  
✅ 核心指标展示（花费、曝光、点击、下载、安装、转化）  
✅ 成本指标计算（注册成本、授信成本、支用成本）  
✅ 数据导出功能  
✅ 响应式设计，支持移动端访问  

### 当前限制
- 数据存储在session中，刷新页面后需要重新上传
- 文件大小限制为50MB
- 数据处理为同步进行，大文件可能需要等待时间

### 后续优化方向

1. **数据持久化**
   - 使用数据库存储处理后的数据
   - 支持历史数据查询和对比

2. **性能优化**
   - 大数据量异步处理
   - 数据分页加载
   - 图表数据缓存

3. **功能增强**
   - 支持更多代理商数据格式
   - 增加数据对比功能（同比、环比）
   - 支持自定义指标计算
   - 增加数据预警功能（成本超阈值提醒）
   - 支持数据定时自动更新

4. **用户体验**
   - 增加数据上传进度条
   - 支持批量文件上传
   - 增加数据预览功能
   - 优化移动端体验

5. **系统功能**
   - 增加用户权限管理
   - 支持多用户协作
   - 数据访问日志记录
   - 系统配置管理

